services:
  xray:
    build: ./xray
    container_name: xray
    ports:
      - "443:443/tcp"
    volumes:
      - ./xray/users.json:/etc/xray/users.json
    environment:
      XRAY_PRIV: ""
      XRAY_PBK: ""
      XRAY_SHORT_ID: ""
      XRAY_SNI: ""
    networks:
      - vpn-net
    restart: unless-stopped

  php-api:
    build: ./php-api
    container_name: php-api
    depends_on:
      - xray
    volumes:
      - ./php-api:/var/www/html
      - ./xray/users.json:/etc/xray/users.json
    environment:
      API_KEY: ""
      XRAY_SERVER_INTERNAL: "xray"
      XRAY_SERVER_PUBLIC: ""
      XRAY_PBK: ""
      XRAY_SHORT_ID: ""
      XRAY_SNI: "st.mycdn.me"
    networks:
      - vpn-net
    restart: unless-stopped

  caddy:
    image: caddy:latest
    container_name: caddy
    restart: unless-stopped
    ports:
      - "80:80"
      - "8443:8443"
    volumes:
      - ./caddy/Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    networks: [vpn-net]

networks:
  vpn-net:
    driver: bridge

volumes:
  caddy_data:
  caddy_config:
